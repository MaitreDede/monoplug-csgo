<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Custom FMOD objects</title><link rel="stylesheet" href="ts3doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="TeamSpeak 3 Client SDK Developer Manual"><link rel="up" href="ar01s15.html" title="Using playback and capture modes and devices"><link rel="prev" href="ar01s15s05.html" title="Activating the capture device"><link rel="next" href="ar01s16.html" title="Sound codecs"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><img id="logo" src="images/logo.png"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Custom FMOD objects</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s15s05.html"><img src="images/prev.png" alt="Prev"></a> </td><th width="60%" align="center">Using playback and capture modes and devices</th><td width="20%" align="right"> <a accesskey="n" href="ar01s16.html"><img src="images/next.png" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="device_customfmod"></a>Custom FMOD objects</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="device_customfmodsystem"></a>Using custom FMOD system objects</h4></div></div></div><p>Instead of using the standard Client Lib functions <a class="link" href="ar01s15.html#initdevice" title="Initializing modes and devices"><code class="function">ts3client_openPlaybackDevice</code></a>, <a class="link" href="ar01s15.html#initdevice" title="Initializing modes and devices"><code class="function">ts3client_openCaptureDevice</code></a> and <a class="link" href="ar01s15s05.html" title="Activating the capture device"><code class="function">ts3client_activateCaptureDevice</code></a> it is possible to supply a <em class="parameter"><code>FMOD::System</code></em> object of your own that is then used by the TeamSpeak 3 SDK. This allows you to integrate your existing FMOD solution for your application with the <a class="ulink" href="http://www.fmod.org" target="_top">FMOD</a> solution used by TeamSpeak 3, or even if you don't use FMOD in your application you can use this functionality if you want more control over the way the <em class="parameter"><code>FMOD::System</code></em> objects are used.</p><p>By managing the <em class="parameter"><code>FMOD::System</code></em> objects yourself and by using the later described <code class="function">onFMODChannelCreatedEvent</code> callback you will be able to use advanced FMOD functionality that the TeamSpeak 3 client SDK does not use and does not expose to be used through the <code class="filename">clientlib.h</code> API, for example custom DSP effects or modelling the 3D world.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Using custom FMOD objects is entirely optional.</p></td></tr></table></div><p>The function to open a playback device using a custom <em class="parameter"><code>FMOD::System</code></em> object is an alternative to <a class="link" href="ar01s15.html#initdevice" title="Initializing modes and devices"><code class="function">ts3client_openPlaybackDevice</code></a>:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3client_openCustomPlaybackDevice</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodSystem</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>void* <var class="pdparam">fmodSystem</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id336975"></a></p><p>The function to open a capture device using a custom <em class="parameter"><code>FMOD::System</code></em> object is an alternative to <a class="link" href="ar01s15.html#initdevice" title="Initializing modes and devices"><code class="function">ts3client_openCaptureDevice</code></a>:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3client_openCustomCaptureDevice</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodSystem</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodDriverID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>void* <var class="pdparam">fmodSystem</var></code>;<br><code>int <var class="pdparam">fmodDriverID</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id337035"></a></p><p>The function to activate the capture device using a custom <em class="parameter"><code>FMOD::System</code></em> object is an alternative to <a class="link" href="ar01s15s05.html" title="Activating the capture device"><code class="function">ts3client_activateCaptureDevice</code></a>:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3client_activateCustomCaptureDevice</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodSystem</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodDriverID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>void* <var class="pdparam">fmodSystem</var></code>;<br><code>int <var class="pdparam">fmodDriverID</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id337095"></a></p><div class="itemizedlist"><p class="title"><b>Parameters</b></p><ul type="disc"><li><p><em class="parameter"><code>serverConnectionHandlerID</code></em></p><p>Connection handler of the server on which you want to initialize or activate the device.</p></li><li><p><em class="parameter"><code>fmodSystem</code></em></p><p>A <em class="parameter"><code>FMOD::System</code></em> object created and customized by your code, as shown in the following examples.</p><p>If you use the FMOD C API, you can pass a <em class="parameter"><code>FMOD_SYSTEM*</code></em> object instead of <em class="parameter"><code>FMOD::System*</code></em>, as the two are interchangable.</p></li><li><p><em class="parameter"><code>fmodDriverID</code></em></p><p>Enumerated FMOD driver ID, see the FMOD documentation for details.</p></li></ul></div><p>All functions return <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The TeamSpeak 3 SDK uses <em class="parameter"><code>void*</code></em> pointers to avoid the dependency on FMOD, as custom FMOD objects is an optional feature.</p></td></tr></table></div><div class="literallayout"><p><br>
</p></div><p>Simple example how to create a <em class="parameter"><code>FMOD::System</code></em> object for opening a capture device:</p><pre class="programlisting">FMOD::System* pFMODSystem = NULL;
FMOD_RESULT result;

result = FMOD::System_Create(&amp;pFMODSystem);
if(result != FMOD_OK) {
    cout &lt;&lt; "System_Create: " &lt;&lt; FMOD_ErrorString(result) &lt;&lt; endl;
    return;
}

result= pFMODSystem-&gt;setOutput(static_cast&lt;FMOD_OUTPUTTYPE&gt;(modeID));
if(result != FMOD_OK) {
    cout &lt;&lt; "setOutput failed (modeID: " &lt;&lt; modeID &lt;&lt; "): " &lt;&lt; FMOD_ErrorString(result) &lt;&lt; endl;
    return;
}

result = pFMODSystem-&gt;init(32, FMOD_INIT_NORMAL, NULL);
if(result != FMOD_OK) {
    cout &lt;&lt; "init: " &lt;&lt; FMOD_ErrorString(result) &lt;&lt; endl;
    return;
}</pre><p>Simple example how to create a <em class="parameter"><code>FMOD::System</code></em> object for opening a playback device:</p><pre class="programlisting">FMOD::System* system = NULL;
FMOD_RESULT result;

result = FMOD::System_Create(&amp;system);
if(result != FMOD_OK) {
    cout &lt;&lt; "System_Create: " &lt;&lt; FMOD_ErrorString(result) &lt;&lt; endl;
    return false;
}

result= system-&gt;setOutput(static_cast&lt;FMOD_OUTPUTTYPE&gt;(modeID));
if(result != FMOD_OK) {
    cout &lt;&lt; "setOutput failed (modeID: " &lt;&lt; modeID &lt;&lt; "): " &lt;&lt; FMOD_ErrorString(result) &lt;&lt; endl;
    return false;
}

result= system-&gt;setDriver(driverID);
if(result != FMOD_OK) {
    cout &lt;&lt; "setDriver: " &lt;&lt; FMOD_ErrorString(result) &lt;&lt; endl;
    return false;
}

result = system-&gt;init(1000, FMOD_INIT_NORMAL, NULL);
if(result != FMOD_OK) {
    cout &lt;&lt; "init: " &lt;&lt; FMOD_ErrorString(result) &lt;&lt; endl;
    return false;
}</pre><p>See <a class="ulink" href="http://www.fmod.org/forum/viewtopic.php?t=9305" target="_top">FMOD Ex Frequently Asked Questions</a> for the recommended way to initialize the output device and the <a class="ulink" href="http://www.fmod.org" target="_top">FMOD</a> API documentation for further details.</p><div class="literallayout"><p><br>
</p></div><p>When the TeamSpeak 3 SDK is using a passed-in <em class="parameter"><code>FMOD::System</code></em> object, it will not call <code class="function">close()</code> or <code class="function">release()</code> on the <em class="parameter"><code>FMOD::System</code></em> object when finished with it, but rather notify the SDK user via a callback that the SDK has finished using the object. You can either call <code class="function">release()</code> on the <em class="parameter"><code>FMOD::System</code></em> object or - if you are still using it in your own application - do nothing.</p><p>When closing a capture device, which has been previously opened using <code class="function">ts3client_openCustomCaptureDevice</code>, the following callback allows to clean-up the custom <em class="parameter"><code>FMOD::System</code></em> object if desired:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onCustomCaptureDeviceCloseEvent</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodSystem</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>void* <var class="pdparam">fmodSystem</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id337348"></a></p><p>When closing a playback device, which has been previously opened using <code class="function">ts3client_openCustomPlaybackDevice</code>, the following callback allows to clean-up the custom <em class="parameter"><code>FMOD::System</code></em> object if desired:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onCustomPlaybackDeviceCloseEvent</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodSystem</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>void* <var class="pdparam">fmodSystem</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id337398"></a></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that you still use the standard ts3client_closePlaybackDevice and ts3client_closeCaptureDevice function to close devices opened using <code class="function">ts3client_openCustomCaptureDevice</code> and <code class="function">ts3client_openCustomPlaybackDevice</code>.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="device_customfmodchannel"></a>Customizing FMOD channel objects</h4></div></div></div><p>FMOD channels are created by the Client Lib whenever a user starts talking. By implementing the following callback, additional settings can be applied to the <em class="parameter"><code>FMOD::Channel</code></em> object.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="function">onFMODChannelCreatedEvent</code> callback is always called, no matter if devices were opened with the standard or custom functions. This allows to apply additional settings to FMOD Channels even if the custom FMOD System objects mechanism is not used.</p><p>If you do not need this callback, just set the function pointer to <em class="parameter"><code>NULL</code></em> in the <span class="structname">ClientUIFunctions</span> parameter for <a class="link" href="ar01s07.html" title="Initializing"><code class="function">ts3client_initClientLib</code></a>.</p></td></tr></table></div><p>The order of operations when a client starts talking is:
</p><div class="itemizedlist"><ul type="disc"><li><p>FMOD channel is created in a paused state.</p></li><li><p>Client Lib sets standard options on the <em class="parameter"><code>FMOD::Channel</code></em> object, like 3D sound settings as set with <a class="link" href="ar01s20.html" title="3D Sound"><code class="function">ts3client_fmod_Channelset3DAttributes</code></a>.</p></li><li><p><code class="function">onFMODChannelCreatedEvent</code> is called and allows you to apply additional settings on the <em class="parameter"><code>FMOD::Channel</code></em> object, or to even overwrite the default settings that were made in the previous step.</p></li><li><p>The FMOD channel is unpaused and the client starts talking.</p></li></ul></div><p>
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onFMODChannelCreatedEvent</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodChannel</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>void* <var class="pdparam">fmodChannel</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id337560"></a></p><div class="itemizedlist"><p class="title"><b>Parameters</b></p><ul type="disc"><li><p><em class="parameter"><code>serverConnectionHandlerID</code></em></p><p>Connection handler of the server on which the FMOD channel is created.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the client who starts talking.</p></li><li><p><em class="parameter"><code>fmodChannel</code></em></p><p>A <em class="parameter"><code>FMOD::Channel</code></em> object on which additional settings can be applied.</p><p>If you use the FMOD C API, cast the <em class="parameter"><code>void* fmodChannel</code></em> object to <em class="parameter"><code>FMOD_CHANNEL*</code></em> instead of <em class="parameter"><code>FMOD::Channel*</code></em>, as the two are interchangable.</p></li></ul></div><p>The callback should return quickly to avoid delaying unpausing the FMOD channel.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="device_getcurrentfmodsystem"></a>Querying the current FMOD System objects</h4></div></div></div><p>The currently used FMOD System playback and capture objects - may it be a standard or custom object - can be queried from the clientlib if you want to use them for own FMOD operations like for example playing wave files.</p><p>Request the current playback device with:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3client_getCurrentPlaybackDevice</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodSystemResult</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>void** <var class="pdparam">fmodSystemResult</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id337691"></a></p><p>Request the current capture device with:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3client_getCurrentCaptureDevice</b>(</code></td><td><var class="pdparam">serverConnectionHandlerID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">fmodSystemResult</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>anyID <var class="pdparam">serverConnectionHandlerID</var></code>;<br><code>void** <var class="pdparam">fmodSystemResult</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="id337730"></a></p><div class="itemizedlist"><p class="title"><b>Parameters</b></p><ul type="disc"><li><p><em class="parameter"><code>serverConnectionHandlerID</code></em></p><p>ID of the server connection handler on which the FMOD system devices should be queried.</p></li><li><p><em class="parameter"><code>serverConnectionHandlerID</code></em></p><p>Address of a variable that receives the requested FMOD System object.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>. If the function fails, <em class="parameter"><code>fmodSystemResult</code></em> is undefined.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s15s05.html"><img src="images/prev.png" alt="Prev"></a> </td><td width="20%" align="center"><a accesskey="u" href="ar01s15.html"><img src="images/up.png" alt="Up"></a></td><td width="40%" align="right"> <a accesskey="n" href="ar01s16.html"><img src="images/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">Activating the capture device </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> Sound codecs</td></tr></table></div></body></html>
